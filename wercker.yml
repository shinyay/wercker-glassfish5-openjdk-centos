box: centos:$OSVERSION
## Install OpenJDK 8
build:
  steps:
    - script:
        name: install-package-for-jdk
        code: |
          yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel
    - script:
        name: post-install-check
        code: |
          echo "export JAVA_HOME=`readlink /etc/alternatives/java | sed -e 's/\/jre\/bin\/java//g'`" >> /root/.bashrc
          source /root/.bashrc
          echo "[java version]"
          java -version
          echo "[env]"
          env
    - internal/docker-push:
         username: $USERNAME
         password: $PASSWORD
         repository: shinyay/centos7-openjdk8
         tag: latest $OSVERSION
         author: shinyay
         cmd: /bin/bash --login
    - script:
        name: install-package-for-glassfish
        code: |
          echo "export GLASSFISH_HOME=/glassfish5" >> /root/.bashrc
          echo "export PATH=$PATH:/glassfish5/bin" >> /root/.bashrc
          source /root/.bashrc
          yum install -y wget unzip
          wget --no-check-certificate http://download.oracle.com/glassfish/5.0/promoted/glassfish-${GF_VERSION}.zip
          ls -l
          unzip -o -d / glassfish-${GF_VERSION}.zip
          rm -f glassfish-${GF_VERSION}.zip
          echo "----- CREATE PASSWORD FILE --------------------" && \
          echo "AS_ADMIN_PASSWORD=" > /tmp/gfpassword && \
          echo "AS_ADMIN_NEWPASSWORD=${GF_PASSWORD}" >> /tmp/gfpassword  && \
          echo "----- CHANGE ADMIN PASSWORD AND SECURE ADMIN ACCESS --------------------" && \
          asadmin --user=admin --passwordfile=/tmp/gfpassword change-admin-password --domain_name domain1 && \
          echo "----- ENABLE DOMAIN ADMINISTRATION SERVER --------------------" && \
          asadmin start-domain && \
          echo "AS_ADMIN_PASSWORD=${GF_PASSWORD}" > /tmp/gfpassword && \
          asadmin --user=admin --passwordfile=/tmp/gfpassword enable-secure-admin && \
          asadmin --user=admin stop-domain
          cp shell/start-domain.sh /root && \
          chmod +x /root/start-domain.sh
    - internal/docker-push:
         username: $USERNAME
         password: $PASSWORD
         repository: shinyay/centos7-openjdk8-glassfish5
         tag: latest $GF_VERSION
         author: shinyay
         working-dir: /root
         ports: 4848 8080 8181
         cmd: /bin/bash --login
